{"version":3,"sources":["../../app/middleware/access-control.js"],"names":["accessControl","role","Error","requiredRoleIndex","userRoles","indexOf","req","res","next","err","currentRoleIndex","currentUser","sendStatus"],"mappings":";;;;;kBAKwBA,a;;AAHxB;;;;AACA;;;;;;AAEe,SAASA,aAAT,CAAuBC,IAAvB,EAAsC;AACnD,MAAI,CAACA,IAAL,EAAW;AACT,UAAM,IAAIC,KAAJ,CAAU,iBAAV,CAAN;AACD;;AAED,MAAMC,oBAA6B,oBAAUC,SAAV,CAAoBC,OAApB,CAA4BJ,IAA5B,CAAnC;;AAEA,MAAIE,oBAAoB,CAAxB,EAA2B;AACzB,UAAM,IAAID,KAAJ,CAAU,mBAAV,CAAN;AACD;;AAED,SAAO,UAACI,GAAD,EAAMC,GAAN,EAAWC,IAAX;AAAA,WAAoB,4BAAaF,GAAb,EAAkBC,GAAlB,EAAuB,UAACE,GAAD,EAAS;AACzD,UAAMC,mBAA4B,oBAAUN,SAAV,CAAoBC,OAApB,CAA4BC,IAAIK,WAAJ,CAAgBV,IAA5C,CAAlC;;AAEA,UACEQ,OACA,CAACH,IAAIK,WADL,IAEAD,mBAAmBP,iBAHrB,EAIE;AACAI,YAAIK,UAAJ,CAAe,GAAf;AACA;AACD;;AAEDJ;AACD,KAb0B,CAApB;AAAA,GAAP;AAcD","file":"access-control.js","sourcesContent":["/* @flow */\n\nimport authenticate from './authenticate'\nimport Constants from '../config/constants'\n\nexport default function accessControl(role : number) {\n  if (!role) {\n    throw new Error('Provide a role.')\n  }\n\n  const requiredRoleIndex : number = Constants.userRoles.indexOf(role)\n\n  if (requiredRoleIndex < 0) {\n    throw new Error('Not a valid role.')\n  }\n\n  return (req, res, next) => authenticate(req, res, (err) => {\n    const currentRoleIndex : number = Constants.userRoles.indexOf(req.currentUser.role)\n\n    if (\n      err ||\n      !req.currentUser ||\n      currentRoleIndex < requiredRoleIndex\n    ) {\n      res.sendStatus(403)\n      return\n    }\n\n    next()\n  })\n}\n"]}